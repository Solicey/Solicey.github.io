<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
    <title>02. 视图变换 | 云知计划</title>
    
    
        <meta name="keywords" content="线性代数,CS,图形学">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="参考资料：  计算机图形学二：视图变换(坐标系转化，正交投影，透视投影，视口变换) 一文读懂正交投影变换  视图变换的任务：把三维虚拟世界中以$(x,y,z)$为坐标的物体变换到用一个个像素位置$(x,y)$表示的二维屏幕坐标系中。整个过程可以被细分成如下几个步骤。  模型变换（modeling transformation）：将虚拟世界中的物体调整至它们应该在的位置。 摄像机变换（camera">
<meta property="og:type" content="article">
<meta property="og:title" content="02. 视图变换">
<meta property="og:url" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/index.html">
<meta property="og:site_name" content="云知计划">
<meta property="og:description" content="参考资料：  计算机图形学二：视图变换(坐标系转化，正交投影，透视投影，视口变换) 一文读懂正交投影变换  视图变换的任务：把三维虚拟世界中以$(x,y,z)$为坐标的物体变换到用一个个像素位置$(x,y)$表示的二维屏幕坐标系中。整个过程可以被细分成如下几个步骤。  模型变换（modeling transformation）：将虚拟世界中的物体调整至它们应该在的位置。 摄像机变换（camera">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/01.png">
<meta property="og:image" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/02.png">
<meta property="og:image" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/03.jpg">
<meta property="og:image" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/04.png">
<meta property="article:published_time" content="2022-07-08T04:15:03.438Z">
<meta property="article:modified_time" content="2022-07-08T13:35:27.463Z">
<meta property="article:author" content="Solitude21">
<meta property="article:tag" content="线性代数">
<meta property="article:tag" content="CS">
<meta property="article:tag" content="图形学">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://solicey.github.io/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/01.png">
    

    

    
        <link rel="icon" href="/css/images/Yunzhi.png">
    

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

    
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>

    
<script src="/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>

    
    
        
<link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">

    
    
        
<link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">

    
    
    
    


    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="云知计划" type="application/atom+xml">
</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">云知计划</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">分类</a>
                
                    <a class="main-nav-link" href="/tags">标签</a>
                
                    <a class="main-nav-link" href="/about">关于</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">分类</a></td>
                
                    <td><a class="main-nav-link" href="/tags">标签</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id="categories">
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id="allExpand" href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            图形学
                        </a>
                         <ul class="unstyled" id="tree"> 
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            GAMES101
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/GAMES101/2022-07-07-%5B01%5D%E5%9F%BA%E6%9C%AC%E5%8F%98%E6%8D%A2%E7%9F%A9%E9%98%B5%E6%80%BB%E7%BB%93/">01. 基本变换矩阵总结</a></li>  <li class="file active"><a href="/wiki/GAMES101/2022-07-08-%5B02%5D%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/">02. 视图变换</a></li>  <li class="file"><a href="/wiki/GAMES101/2022-07-09-%5B03%5D%E5%85%89%E6%A0%85%E5%8C%96/">03. 光栅化与抗锯齿</a></li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            日志
                        </a>
                         <ul class="unstyled" id="tree">  <li class="file"><a href="/wiki/Logs/hello-world/">云知计划3.0</a></li>  <li class="file"><a href="/wiki/Logs/Hexo%E5%8D%9A%E5%AE%A2%E5%A4%87%E5%BF%98%E5%BD%95/">Hexo博客备忘录</a></li>  </ul> 
                    </li> 
                     </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-GAMES101/2022-07-08-[02]视图变换" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
                    <div class="article-meta">
                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/%E5%9B%BE%E5%BD%A2%E5%AD%A6/GAMES101/">GAMES101</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/CS/" rel="tag">CS</a>, <a class="tag-link-link" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" rel="tag">图形学</a>, <a class="tag-link-link" href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" rel="tag">线性代数</a>
    </div>

                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/GAMES101/2022-07-08-%5B02%5D%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/">
            <time datetime="2022-07-08T04:15:03.438Z" itemprop="datePublished">2022-07-08</time>
        </a>
    </div>


                        
                            <i class="fa fa-bar-chart"></i>
                            <span id="busuanzi_container_site_pv"><span id="busuanzi_value_page_pv"></span></span>    
                        
                        
                    </div>
                
                
    
        <h1 class="article-title" itemprop="name">
            02. 视图变换
        </h1>
    

            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
        
            
                <div id="toc" class="toc-article">
                <strong class="toc-title">Catalogue</strong>
                    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%8F%98%E6%8D%A2%EF%BC%88modeling-transformation%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">模型变换（modeling transformation）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%91%84%E5%83%8F%E6%9C%BA%E5%8F%98%E6%8D%A2%EF%BC%88camera-transformation%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">摄像机变换（camera transformation）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1%E5%8F%98%E6%8D%A2%EF%BC%88projection-transformation%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">投影变换（projection transformation）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E4%BA%A4%E6%8A%95%E5%BD%B1%E5%8F%98%E6%8D%A2"><span class="toc-number">3.1.</span> <span class="toc-text">正交投影变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E8%A7%86%E6%8A%95%E5%BD%B1%E5%8F%98%E6%8D%A2"><span class="toc-number">3.2.</span> <span class="toc-text">透视投影变换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%8F%A3%E5%8F%98%E6%8D%A2%EF%BC%88viewport-transformation%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">视口变换（viewport transformation）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E4%BD%9C%E4%B8%9A01"><span class="toc-number">5.</span> <span class="toc-text">总结与作业01</span></a></li></ol>
                </div>
            
        
        
            <p>参考资料：</p>
<ol>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/qq_38065509/article/details/105309174">计算机图形学二：视图变换(坐标系转化，正交投影，透视投影，视口变换)</a></li>
<li><a target="_blank" rel="external nofollow noopener noreferrer" href="https://zhuanlan.zhihu.com/p/473031788">一文读懂正交投影变换</a></li>
</ol>
<p>视图变换的任务：把三维虚拟世界中以$(x,y,z)$为坐标的物体变换到用一个个像素位置$(x,y)$表示的二维屏幕坐标系中。整个过程可以被细分成如下几个步骤。</p>
<ol>
<li>模型变换（modeling transformation）：将虚拟世界中的物体调整至它们应该在的位置。</li>
<li>摄像机变换（camera transformation）：我们真正在乎的是摄像机所看到的东西，因此需要得到物体与摄像机的相对位置。</li>
<li>投影变换（projection transformation）：得到所有可视范围内的物体对于摄像机的相对位置坐标$(x,y,z)$后，进行<strong>正交投影</strong>或者<strong>透视投影</strong>，将三维物体投影至<strong>标准二维平面</strong>（$[-1,1]\times[-1,1]$）上。</li>
<li>视口变换（viewport transformation）：将标准平面映射到屏幕分辨率范围内，即$[-1,1]\times[-1,1]\rightarrow[0,width]\times[0,height]$.</li>
</ol>
<p><img src="/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/01.png" alt="示意图"></p>
<hr>
<h1 id="模型变换（modeling-transformation）"><a href="#模型变换（modeling-transformation）" class="headerlink" title="模型变换（modeling transformation）"></a>模型变换（modeling transformation）</h1><p>模型变换其实就是利用基本变换矩阵将模型调整至我们想要的地方，详情请见<a href="/wiki/GAMES101/2022-07-07-[01]基本变换矩阵总结/">基本变换矩阵总结</a>。</p>
<hr>
<h1 id="摄像机变换（camera-transformation）"><a href="#摄像机变换（camera-transformation）" class="headerlink" title="摄像机变换（camera transformation）"></a>摄像机变换（camera transformation）</h1><p>前面提到，我们需要获得物体与摄像机的相对位置。如果我们把摄像机和物体一起移动，并将摄像机的坐标轴（设为$u,v,w$）移动到世界坐标轴$x,y,z$，那么此时物体的坐标就是与摄像机的相对坐标。</p>
<p>那么如何让摄像机的坐标系与世界坐标系重合呢？我们先定义三个变量</p>
<ol>
<li>摄像机位置(eye position)： $\bf{e}$</li>
<li>观察方向(gaze position)： $\bf{g}$</li>
<li>视点正上方向(view-up vector)： $\bf{t}$</li>
</ol>
<p>那么我们就可以建立摄像机坐标系了，定义如下：</p>
<script type="math/tex; mode=display">
\begin{aligned}
\bf{w} & = -\frac{\bf{g}}{\parallel\bf{g}\parallel}, \\
\bf{u} & = \frac{\bf{t}\times \bf{w}}{\parallel\bf{t}\times \bf{w}\parallel},\\
\bf{v} & = \bf{w} \times u
\end{aligned}</script><p>其中$u,v,w$对应标准坐标系的$x,y,z$。示意图如下所示：</p>
<p><img src="/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/02.png" alt="示意图"></p>
<p>其实我感觉，直接拿$\bf{t}$作为基向量也不是不行，而且还更省事一些。</p>
<p>接下来，就要将其移动到世界坐标系。有如下两个步骤：</p>
<ol>
<li>将相机位置移动到世界坐标系原点</li>
<li>通过旋转矩阵将二者坐标系重合</li>
</ol>
<p>第一步只需要简单地减去相机位置坐标$\bf{e}$即可，第二步只需用一个$(u,v,w)^T$矩阵就能将摄像机坐标系旋转至世界坐标系，这部分内容在<a href="/wiki/GAMES101/2022-07-07-[01]基本变换矩阵总结">基本变换矩阵总结</a>中的“绕任意轴旋转”提到过。</p>
<p>我们定义摄像机变换矩阵$M_{cam}$如下所示：</p>
<script type="math/tex; mode=display">
\bf{M_{cam}}=
\begin{bmatrix}
\bf{u} & \bf{v} & \bf{w} & \bf{e} \\
0 & 0 & 0 & 1 
\end{bmatrix}^{-1}=
\begin{bmatrix}
x_u & y_u & z_u & 0 \\
x_v & y_v & z_v & 0 \\
x_w & y_w & z_w & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
1 & 0 & 0 & -x_e \\
0 & 1 & 0 & -y_e \\
0 & 0 & 1 & -z_e \\
0 & 0 & 0 & 1
\end{bmatrix}</script><p>注意到，我们是先位移再线性变换，所以不能直接把两个操作合并成一个<strong><a href="/wiki/GAMES101/2022-07-07-[01]基本变换矩阵总结/#仿射变换">仿射变换</a></strong>矩阵。</p>
<hr>
<h1 id="投影变换（projection-transformation）"><a href="#投影变换（projection-transformation）" class="headerlink" title="投影变换（projection transformation）"></a>投影变换（projection transformation）</h1><p>投影变换分为<a href="#正交投影变换"><strong>正交投影变换</strong></a>与<a href="#透视投影变换"><strong>透视投影变换</strong></a>。</p>
<h2 id="正交投影变换"><a href="#正交投影变换" class="headerlink" title="正交投影变换"></a>正交投影变换</h2><p>在正交投影中，所有的光线都是平行传播。这些平行光将物体的影像垂直地投射到画面上。为了节省计算资源，我们会定义一个“可视空间”，只有在可视空间中的物体才需要绘制。</p>
<p>正交投影定义的可视空间是一个盒状的空间，由上下左右远近共6个裁切面组成。</p>
<p><img src="/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/03.jpg" alt="盒状可视空间"></p>
<p>值得注意的是，由于观察方向是$z$轴的负方向，故$n&gt;f$.</p>
<p>我们采用如下步骤，将可视空间压缩至一个$[-1,1]^3$的空间当中。规范化坐标系是为了方便移植，使得坐标系独立于各种尺寸的图形设备。为了能够确定物体的前后关系，我们仍需保留$z$轴的值，故我们采用四维的齐次坐标系。</p>
<ol>
<li>平移变换：将盒状可视空间的中心点移动到坐标原点。这一步的变换矩阵为：</li>
</ol>
<script type="math/tex; mode=display">
\bf{M_{translate}}=
\begin{bmatrix}
1 & 0 & 0 & -\frac{r+l}{2} \\
0 & 1 & 0 & -\frac{t+b}{2} \\
0 & 0 & 1 & -\frac{n+f}{2} \\
0 & 0 & 0 & 1
\end{bmatrix}</script><ol>
<li>缩放变换：通过缩放使其成为范围都是$[-1,1]$的立方体。这一步的变换矩阵为：</li>
</ol>
<script type="math/tex; mode=display">
\bf{M_{scale}}=
\begin{bmatrix}
\frac{2}{r-l} & 0 & 0 & 0 \\
0 & \frac{2}{t-b} & 0 & 0 \\
0 & 0 & \frac{2}{n-f} & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}</script><p>两个矩阵相乘后就得到了正交投影变换矩阵：</p>
<script type="math/tex; mode=display">
\bf{M_{ortho}}=\bf{M_{scale}}\bf{M_{translate}}=
\begin{bmatrix}
\frac{2}{r-l} & 0 & 0 & -\frac{r+l}{r-l} \\
0 & \frac{2}{t-b} & 0 & -\frac{t+b}{t-b} \\
0 & 0 & \frac{2}{n-f} & -\frac{n+f}{n-f} \\
0 & 0 & 0 & 1
\end{bmatrix}</script><h2 id="透视投影变换"><a href="#透视投影变换" class="headerlink" title="透视投影变换"></a>透视投影变换</h2><p>透视投影遵循近大远小的透视原理，其可视空间不再是“盒状”，而是“四棱台”状。我们希望将这个四棱台“压缩”成盒状，再将其规范化。下图是投影过程的剖面图。</p>
<p><img src="/wiki/GAMES101/2022-07-08-[02]%E8%A7%86%E5%9B%BE%E5%8F%98%E6%8D%A2/04.png" alt="透视投影"></p>
<p>$z=-n$是投影平面。我们将点$(x,y,z)$投影至该平面后，它的坐标变为$(x’,y’,z’)$。利用相似三角形的性质，我们很容易求得$x’$和$y’$。然而，我们希望在变换的过程中，像正交投影那样保留$z$轴的信息以表示物体的远近。简单地令$z’=z$显然不正确，如果我们暂时不知如何解决，不妨先用未知量表示。</p>
<p>我们希望找到一个矩阵完成如下变换：</p>
<script type="math/tex; mode=display">
\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
\Rightarrow
\begin{pmatrix}
nx/z \\
ny/z \\
\rm{unknown} \\
1
\end{pmatrix}
\Rightarrow^{(\text{mult. by z})}
\begin{pmatrix}
nx \\
ny \\
\rm{still\ unknown} \\
z
\end{pmatrix}</script><p>即：</p>
<script type="math/tex; mode=display">
\bf{M_{persp\rightarrow ortho}^{(4\times 4)}}
\begin{pmatrix}
x \\
y \\
z \\
1
\end{pmatrix}
=
\begin{pmatrix}
nx \\
ny \\
\rm{unknown} \\
z
\end{pmatrix}</script><p>我们很容易地确定了这个矩阵的前两行和最后一行：</p>
<script type="math/tex; mode=display">
\bf{M_{persp\rightarrow ortho}^{(4\times 4)}}=
\begin{bmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
? & ? & ? & ? \\
0 & 0 & 1 & 0
\end{bmatrix}</script><p>为了确定第三行，我们需要利用透视投影的一个性质：可视空间的<strong>前后面</strong>$z$轴坐标变换前后保持不变。</p>
<p>设第三行为$(0,0,A,B)$，利用这个性质分别代入远近平面的任意两点就可以列出等式：</p>
<script type="math/tex; mode=display">
\begin{cases}
An+B=n^2 \\
Af+B=f^2
\end{cases}</script><p>容易解得$A=n+f,\ B=-nf$。</p>
<p>因此变换矩阵为：</p>
<script type="math/tex; mode=display">
\bf{M_{persp\rightarrow ortho}^{(4\times 4)}}=
\begin{bmatrix}
n & 0 & 0 & 0 \\
0 & n & 0 & 0 \\
0 & 0 & n+f & -fn \\
0 & 0 & 1 & 0
\end{bmatrix}</script><p>接下来的操作就和正交投影变换一样了，将压缩得到的盒状空间规范化成标准立方体。</p>
<script type="math/tex; mode=display">
\bf{M_{persp}}=\bf{M_{ortho}}\bf{M_{persp\rightarrow ortho}}=\begin{bmatrix}
\frac{2n}{r-l} & 0 & \frac{l+r}{l-r} & 0 \\
0 & \frac{2n}{t-b} & \frac{b+t}{b-t} & 0 \\
0 & 0 & \frac{f+n}{n-f} & \frac{2fn}{f-n} \\
0 & 0 & 1 & 0
\end{bmatrix}</script><hr>
<h1 id="视口变换（viewport-transformation）"><a href="#视口变换（viewport-transformation）" class="headerlink" title="视口变换（viewport transformation）"></a>视口变换（viewport transformation）</h1><p>视口变换就是两个范围空间的转换$[-1,1]\times[-1,1]\rightarrow[0,width]\times[0,height]$，我们可以先缩放，再位移。</p>
<script type="math/tex; mode=display">
\bf{M_{viewport}}=
\begin{bmatrix}
\frac{width}{2} & 0 & 0 & \frac{width}{2} \\
0 & \frac{height}{2} & 0 & \frac{height}{2} \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{bmatrix}</script><hr>
<h1 id="总结与作业01"><a href="#总结与作业01" class="headerlink" title="总结与作业01"></a>总结与作业01</h1><p>经历上述四个变换，我们就可以把虚拟世界中的任意可视物体投射到屏幕上了！总的矩阵就是：</p>
<script type="math/tex; mode=display">
\bf{M}=\bf{M_{viewport}}\bf{M_{persp}}\bf{M_{camera}}\bf{M_{model}}</script><p>作业01要求我们完善两个函数：模型变换函数与投影变换函数。</p>
<ul>
<li><code>get_model_matrix(float rotation_angle)</code>：<br>构建绕<code>z</code>轴旋转<code>rotation_angle</code>角度的变换矩阵，并返回该矩阵。</li>
<li><code>get_projection_matrix(float eye_fov, float aspect_ratio, float zNear, float zFar)</code>：使用给定的参数，构建透视投影矩阵。<br>其中<code>eye_fov</code>是视场角（竖直方向），<code>aspect_ratio</code>是宽高比。</li>
</ul>
<p>代码如下：（代码来源：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/why18767183086/article/details/107237618?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165728524816781683994957%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=165728524816781683994957&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_click~default-1-107237618-null-null.142^v32^pc_rank_34,185^v2^control&amp;utm_term=games101%E4%BD%9C%E4%B8%9A1&amp;spm=1018.2226.3001.4187">games101作业1：旋转与投影</a>）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_model_matrix</span><span class="params">(<span class="type">float</span> angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix4f rotation;</span><br><span class="line">    angle = angle * MY_PI / <span class="number">180.f</span>;</span><br><span class="line">    rotation &lt;&lt; <span class="built_in">cos</span>(angle), <span class="number">0</span>, <span class="built_in">sin</span>(angle), <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                -<span class="built_in">sin</span>(angle), <span class="number">0</span>, <span class="built_in">cos</span>(angle), <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f scale;</span><br><span class="line">    scale &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">              <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">              <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">              <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f translate;</span><br><span class="line">    translate &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">            <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> translate * rotation * scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Eigen::Matrix4f projection = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line">	<span class="function">Eigen::Matrix4f <span class="title">M_persp2ortho</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">	<span class="function">Eigen::Matrix4f <span class="title">M_ortho_scale</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">	<span class="function">Eigen::Matrix4f <span class="title">M_ortho_trans</span><span class="params">(<span class="number">4</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">float</span> angle = eye_fov * MY_PI / <span class="number">180.0</span>; <span class="comment">// 视场角（弧度制）</span></span><br><span class="line">	<span class="type">float</span> height = zNear * <span class="built_in">tan</span>(angle / <span class="number">2</span>) * <span class="number">2</span>;</span><br><span class="line">	<span class="type">float</span> width = height * aspect_ratio;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">auto</span> t = -zNear * <span class="built_in">tan</span>(angle / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">auto</span> b = -t;</span><br><span class="line">	<span class="keyword">auto</span> r = t * aspect_ratio;</span><br><span class="line">	<span class="keyword">auto</span> l = -r;</span><br><span class="line"></span><br><span class="line">	M_persp2ortho &lt;&lt; zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear * zFar,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	M_ortho_scale &lt;&lt; <span class="number">2</span> / (r - l), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">2</span> / (t - b), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (zNear - zFar), <span class="number">0</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	M_ortho_trans &lt;&lt; <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(r + l) / <span class="number">2</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(t + b) / <span class="number">2</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(zNear + zFar) / <span class="number">2</span>,</span><br><span class="line">		<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">	Eigen::Matrix4f M_ortho = M_ortho_scale * M_ortho_trans;</span><br><span class="line">	projection = M_ortho * M_persp2ortho * projection;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
END.</script>
            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/wiki/GAMES101/2022-07-09-%5B03%5D%E5%85%89%E6%A0%85%E5%8C%96/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Newer</strong>
            <div class="article-nav-title">
                
                    03. 光栅化与抗锯齿
                
            </div>
        </a>
    
    
        <a href="/wiki/Logs/Hexo%E5%8D%9A%E5%AE%A2%E5%A4%87%E5%BF%98%E5%BD%95/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">Older</strong>
            <div class="article-nav-title">Hexo博客备忘录</div>
        </a>
    
</nav>





    
    




<!-- baidu url auto push script -->
<script type="text/javascript">
    !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
</script>     
</section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            Solitude21 &copy; 2022 
            <a rel="external nofollow noopener noreferrer" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png"></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. Theme - <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
                <br>
                <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_site_pv"></span></span>
                &nbsp;|&nbsp;
                <span id="busuanzi_container_site_pv"><i class="fa fa-user"></i> <span id="busuanzi_value_site_uv"></span></span>
            
        </div>
    </div>
</footer>

        

    
        
<script src="/libs/lightgallery/js/lightgallery.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-pager.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-zoom.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-hash.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-share.min.js"></script>

        
<script src="/libs/lightgallery/js/lg-video.min.js"></script>

    
    
        
<script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>

    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->

<script src="/js/main.js"></script>


    </div>
</body>
</html>